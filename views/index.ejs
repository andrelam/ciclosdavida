<!-- views/index.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <% include head.ejs %>
</head>
<body class="container">

    <header>
        <% include header.ejs %>
    </header>

    <main>
		<% if (message.length > 0) { %>
			<div class="alert alert-danger"><%= message %></div>
		<% } %>
        <div class="jumbotron">
            <h1>Preencha os dados abaixo</h1>
			<form action="/" method="post" onsubmit="return checkForm(this);">
				<div class="form-group">
					<label>Email</label>
					<input type="text" class="form-control" name="email" required placeholder="Informe seu e-mail">
				</div>
				<div class="form-group">
					<label>Nome</label>
					<input type="text" class="form-control" name="nome" required placeholder="Informe seu nome completo">
				</div>
				<div class="form-group">
					<label>Data de Nascimento</label>
					<input type="text" size="12" class="form-control" name="data" required placeholder="DD/MM/AAAA">
				</div>

				<button type="submit" class="btn btn-warning btn-lg">Calcular mapa</button>
			</form>
        </div>
    </main>
	
    <footer>
        <% include footer.ejs %>
    </footer>

	<script type="text/javascript">
    // Original JavaScript code by Chirp Internet: www.chirp.com.au
    // Please acknowledge use of this code by including this header.
	function checkForm(form) {
		var allowBlank = false;
		var minYear = 1902;
		var maxYear = (new Date()).getFullYear();

		var errorMsg = "";

		// regular expression to match required date format
		re = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;

		if(form.data.value != '') {
		  if(regs = form.data.value.match(re)) {
			if(regs[1] < 1 || regs[1] > 31) {
			  errorMsg = "Dia inválido: " + regs[1];
			} else if(regs[2] < 1 || regs[2] > 12) {
			  errorMsg = "Mês inválido: " + regs[2];
			} else if(regs[3] < minYear || regs[3] > maxYear) {
			  errorMsg = "Ano inválido: " + regs[3] + " - deve estar entre " + minYear + " e " + maxYear;
			}
		  } else {
			errorMsg = "Data inválida: " + form.data.value;
		  }
		} else if(!allowBlank) {
		  errorMsg = "Data de Nascimento obrigatória";
		}

		if(errorMsg != "") {
		  alert(errorMsg);
		  form.data.focus();
		  return false;
		} else {
			var datas = form.data.value.match(re);
			var data = new Date();
			data.setUTCFullYear(datas[3]);
			data.setUTCMonth(datas[2] - 1);
			data.setUTCDate(datas[1]);
			data.setUTCHours(0);
			data.setUTCMinutes(0);
			data.setUTCSeconds(0);
			data.setUTCMilliseconds(0);
			if (data.getUTCFullYear() == datas[3] && (data.getUTCMonth() + 1) == datas[2] && data.getUTCDate() == datas[1])
				return true;
			alert("Data inválida");
			form.data.focus();
			return false;
		}
	}
	</script>
</body>
</html>