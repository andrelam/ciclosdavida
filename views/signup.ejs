<!-- views/index.ejs -->

<!DOCTYPE html>
<html lang="pt">
<head>
    <% include head.ejs %>
</head>
<body>

    <% include header.ejs %>

	<div class="container">
		<div class="col-sm-8 col-sm-offset-2">
			<% if (message.length > 0) { %>
				<div class="alert alert-danger"><%= message %></div>
			<% } %>
			<h1>Fa&ccedil;a seu cadastro!</h1>
			<p>Informe os dados abaixo corretamente para obter acesso ao seu mapa dos Ciclos da Vida.</p>
			<form action="/registro" method="post" onsubmit="return checkForm(this);">
				<div class="form-group">
					<label>Nome Completo</label>
					<input type="text" class="form-control" name="nome" required placeholder="Informe seu nome completo">
				</div>
				<div class="form-group">
					<label>Data de Nascimento</label>
					<input type="text" size="12" class="form-control" name="data" required placeholder="DD/MM/AAAA">
				</div>
				<div class="form-group">
					<label>Email</label>
					<input type="text" class="form-control" name="email" required placeholder="Informe seu e-mail">
				</div>
				<div class="form-group">
					<label>Senha</label>
					<input type="password" class="form-control" name="password" required placeholder="Informe uma senha">
				</div>
				<button type="submit" class="btn btn-warning btn-lg">Registrar</button>
			</form>
			<p>Seus dados ser&atilde;o utilizados com o <b>&uacute;nico prop&oacute;sito</b> de permitir o acesso ao seu mapa da vida, e sua senha &eacute; armazenada de forma criptografada, n&atilde;o sendo poss&iacute;vel recuper&aacute;-la.</p>
		</div>

	</div>
	
	<% include footer.ejs %>

	<script type="text/javascript">
    // Original JavaScript code by Chirp Internet: www.chirp.com.au
    // Please acknowledge use of this code by including this header.
	function checkForm(form) {
		var allowBlank = false;
		var minYear = 1902;
		var maxYear = (new Date()).getFullYear();

		var errorMsg = "";

		// regular expression to match required date format
		re = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;

		if(form.data.value != '') {
		  if(regs = form.data.value.match(re)) {
			if(regs[1] < 1 || regs[1] > 31) {
			  errorMsg = "Dia inválido: " + regs[1];
			} else if(regs[2] < 1 || regs[2] > 12) {
			  errorMsg = "Mês inválido: " + regs[2];
			} else if(regs[3] < minYear || regs[3] > maxYear) {
			  errorMsg = "Ano inválido: " + regs[3] + " - deve estar entre " + minYear + " e " + maxYear;
			}
		  } else {
			errorMsg = "Data inválida: " + form.data.value;
		  }
		} else if(!allowBlank) {
		  errorMsg = "Data de Nascimento obrigatória";
		}

		if(errorMsg != "") {
		  alert(errorMsg);
		  form.data.focus();
		  return false;
		} else {
			var datas = form.data.value.match(re);
			var data = new Date(datas[3], datas[2] - 1, datas[1], 0, 0, 0, 0);
			if (data.getUTCFullYear() == datas[3] && (data.getUTCMonth() + 1) == datas[2] && data.getUTCDate() == datas[1])
				return true;
			alert("Data inválida " + data);
			form.data.focus();
			return false;
		}
	}
	</script>

</body>
</html>
